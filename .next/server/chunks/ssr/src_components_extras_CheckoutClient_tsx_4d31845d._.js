module.exports=[48119,a=>{"use strict";var b=a.i(87924),c=a.i(71987),d=a.i(46086),e=a.i(67137),f=a.i(72131),g=a.i(6704),h=a.i(50944),i=a.i(98665),j=a.i(7107),k=a.i(31173),l=a.i(71682),m=a.i(40680);let n={name:"",mobile:"",alternateMobile:"",pin:"",area:"",city:"",state:"",landmark:"",type:"Home"};function o({onClose:a,onSuccess:c}){let{customer:e}=(0,d.useCustomer)(),[h,i]=(0,f.useState)(n),[j,k]=(0,f.useState)(!1),l=async()=>{if(e?._id){let a,b,d;if(!h.name||!h.mobile||!h.pin||!h.area||!h.city||!h.state)return void g.default.error("Please fill all required fields");if(a=h.mobile,!/^\d{10}$/.test(a))return void g.default.error("Mobile must be 10 digits");if(h.alternateMobile&&(b=h.alternateMobile,!/^\d{10}$/.test(b)))return void g.default.error("Alternate mobile must be 10 digits");if(d=h.pin,!/^\d{6}$/.test(d))return void g.default.error("Pin code must be 6 digits");try{k(!0),e.addresses;let a=await fetch(`https://api.ganpatirudraakshaam.com/api/customer/${e._id}/address`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(h)}),b=await a.json();if(!a.ok||!b.address?._id)throw Error("Failed to add address");g.default.success("Address added"),c(b.address._id)}catch(a){console.error(a),g.default.error("Failed to save address")}finally{k(!1)}}};return(0,b.jsx)("div",{className:"fixed inset-0 z-[999] flex items-center justify-center bg-black/40",children:(0,b.jsxs)("div",{className:"bg-white w-full max-w-2xl rounded-md p-6 relative animate-fadeIn",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-defined-black",children:"Add New Address"}),(0,b.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-red-500 text-xl",children:"✕"})]}),(0,b.jsx)(m.default,{form:h,onChange:a=>i(a)}),(0,b.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,b.jsx)("button",{onClick:a,className:"px-5 py-2 rounded-md text-sm border border-gray-300",children:"Cancel"}),(0,b.jsx)("button",{onClick:l,disabled:j,className:`px-6 py-2 rounded-md text-sm text-white ${j?"bg-gray-400 cursor-not-allowed":"bg-define-red hover:bg-red-700"}`,children:j?"Saving...":"Save & Deliver Here"})]})]})})}async function p(){return new Promise((a,b)=>{if(window.Razorpay)return a();let c=document.createElement("script");c.src="https://checkout.razorpay.com/v1/checkout.js",c.onload=()=>a(),c.onerror=()=>b(Error("Failed to load Razorpay SDK")),document.body.appendChild(c)})}function q(){let[a,m]=(0,f.useState)([]),[n,q]=(0,f.useState)(null),[r,s]=(0,f.useState)(0),[t,u]=(0,f.useState)(""),[v,w]=(0,f.useState)(!1),[x,y]=(0,f.useState)(!1),[z,A]=(0,f.useState)(null),B=(0,h.useRouter)(),[C,D]=(0,f.useState)(!1),{customer:E,refreshCustomer:F}=(0,d.useCustomer)(),G=E?._id,[H,I]=(0,f.useState)(""),J=(0,h.useSearchParams)(),K=J.get("mode"),L=E?.addresses||[],M=L.find(a=>a.type?.toLowerCase()==="home")||L[0],N=L.find(a=>a._id===z)||M,[O,P]=(0,f.useState)([]);(0,f.useEffect)(()=>{if(E){if("buy-now"===K){let a=sessionStorage.getItem("BUY_NOW_ITEM");if(!a)return void P([]);let b=JSON.parse(a);P([{productId:b.productId,variantId:b.variantId,quantity:b.quantity,priceAtTime:b.price}])}else if("cart"===K){let a=J.get("items");if(a)return void P(JSON.parse(decodeURIComponent(a)).map(a=>{let b=(E.cart||[]).find(b=>b.productId._id===a.productId);if(!b)return null;let c=b.productId.stock||0;return 0===c||a.quantity>c?null:{productId:b.productId,variantId:b.variantId,quantity:a.quantity,priceAtTime:a.priceAtTime}}).filter(Boolean));P((E.cart||[]).filter(a=>{let b=a.productId.stock||0;return b>0&&a.quantity<=b}))}}},[K,E,J]);let Q=async()=>{if(!G)return;let a=sessionStorage.getItem("BUY_NOW_ITEM");if(!a)return;let b=JSON.parse(a);try{await (0,e.removeFromCartApi)(G,b.productId,b.variantId),sessionStorage.removeItem("BUY_NOW_ITEM"),await F()}catch(a){console.error("Failed to remove buy-now item from cart",a)}},R=a=>{let b=a.productId.stock||0;return 0===b?"out":b<=3?"low":"available"},S=O.filter(a=>"out"!==R(a)),T=S.reduce((a,b)=>a+Math.round((b.productId.mrp||0)*b.quantity),0),U=S.reduce((a,b)=>{let c=b.productId;return a+Math.round((c.mrp||0)*(c.discount||0)/100)*b.quantity},0),V=T-U,W=S.reduce((a,b)=>a+b.quantity,0),X=O.some(a=>"out"===R(a));S.reduce((a,b)=>a+(b.productId.price||0)*b.quantity,0);let Y=async()=>{if(X)return void g.default.error("Please remove out-of-stock items before payment");try{await p();let a=await fetch("https://api.ganpatirudraakshaam.com/api/order/razorpay/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:Math.max(V-r,0),currency:"INR"})}),b=await a.json();if(!b.success)return void alert("Failed to create Razorpay order");let{order:c,key:d}=b,e={key:d,amount:c.amount,currency:c.currency,name:"Pri Priya Nursery",description:"Order Payment",order_id:c.id,handler:async a=>{let b=await fetch("https://api.ganpatirudraakshaam.com/api/order/razorpay/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:a.razorpay_order_id,razorpay_payment_id:a.razorpay_payment_id,razorpay_signature:a.razorpay_signature,customer:G,mobile:E?.mobile,address:N,items:O.map(a=>({product:a.productId._id,quantity:a.quantity,price:a.productId.price})),couponCode:n?.code,couponDiscount:r,orderValue:V-r})}),c=await b.json();if(c.success){g.default.success("Payment successful & verified!"),"buy-now"===K&&await Q();let a=c.paymentGroupId,b=c.orders.join(",");B.push(`/thank-you?payment=${a}&order=${b}`),await F()}else g.default.error("Payment verification failed")},prefill:{name:E?.name,contact:E?.mobile},theme:{color:"#16a34a"}};new window.Razorpay(e).open()}catch(a){console.error(a),alert("Payment failed")}},Z=(a,b,c)=>{if(!(c<1)&&(P(d=>d.map(d=>{if(d.productId._id!==a||d.variantId?._id!==b)return d;let e=d.productId.stock||0;return c>e?(g.default.error(`Only ${e} items available`),d):{...d,quantity:c}})),"buy-now"===K)){let a=sessionStorage.getItem("BUY_NOW_ITEM");if(a){let b=JSON.parse(a);sessionStorage.setItem("BUY_NOW_ITEM",JSON.stringify({...b,quantity:c}))}}},$=async a=>{if(G)try{await (0,j.toggleWishlistApi)(G,a.productId._id),await (0,e.removeFromCartApi)(G,a.productId?._id,a.variantId?._id),await F(),g.default.success("Moved to wishlist")}catch(a){console.error(a),g.default.error("Failed to move to wishlist")}},_=async a=>{G&&(await (0,e.removeFromCartApi)(G,a.productId._id,a.variantId?._id),await F())};(0,f.useEffect)(()=>{V<=0||(async()=>{try{let a=await fetch(`https://api.ganpatirudraakshaam.com/api/coupon?min=${V}&expire=${new Date().toISOString()}`),b=await a.json();m(b.coupons||[])}catch(a){console.error("Failed to fetch coupons",a)}})()},[V]);let aa=async()=>{await (0,i.logout)(),B.replace("/")};(0,f.useEffect)(()=>{N&&!z&&A(N._id)},[N,z]);let ab=a=>{let b=0;b="percentage"===a.discountType?Math.round(V*a.discountValue/100):Math.round(a.discountValue),a.maxDiscountAmount&&(b=Math.min(b,a.maxDiscountAmount)),q(a),s(b),u(`Coupon ${a.code} applied`)},ac=Math.max(Math.round(V-r),0);return((0,f.useEffect)(()=>{let a=sessionStorage.getItem("SELECTED_ADDRESS_ID");a&&L.some(b=>b._id===a)?A(a):M?._id&&A(M._id)},[L]),O.length)?(0,b.jsxs)("div",{className:"max-w-300 px-4 mx-auto grid grid-cols-1 lg:grid-cols-3 py-6 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-col text-define-black bg-white rounded-md p-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("p",{className:"font-medium text-sm lg:text-base",children:"Login"}),v?null:(0,b.jsxs)("button",{onClick:()=>w(!0),className:"text-define-black flex flex-row gap-2 items-center text-xs lg:text-sm p-1 px-3 bg-yellow-500  rounded",children:[(0,b.jsx)(k.IoMdSync,{})," Change Account"]})]}),v?(0,b.jsxs)("div",{className:"mt-3 flex justify-between items-center",children:[(0,b.jsx)("button",{onClick:aa,className:"text-red-500 lg:text-sm text-xs underline",children:"Logout & sign in to different account"}),(0,b.jsx)("button",{onClick:()=>w(!1),className:"text-xs lg:text-base p-1 lg:p-2 bg-define-brown text-white rounded",children:"Continue Checkout"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"font-semibold text-sm lg:text-base",children:E?.name}),(0,b.jsxs)("p",{className:"text-xs lg:text-base",children:["+",E?.mobile," | ",E?.email]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col text-define-black bg-white rounded-md p-4 mt-2",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("p",{className:"font-medium text-sm lg:text-base",children:"Delivery Address"}),x?(0,b.jsxs)("button",{onClick:()=>D(!0),className:"text-define-black flex flex-row gap-2 items-center text-xs lg:text-sm p-1 px-3 bg-yellow-500  rounded",children:[(0,b.jsx)(l.FaPlus,{}),"Add New Address"]}):(0,b.jsxs)("button",{onClick:()=>y(!0),className:"text-define-black flex flex-row gap-2 items-center text-xs lg:text-sm p-1 px-3 bg-yellow-500  rounded",children:[(0,b.jsx)(k.IoMdSync,{})," Change Address"]})]}),!x&&N&&(0,b.jsxs)("div",{className:"mt-2 text-xs lg:text-base",children:[(0,b.jsxs)("p",{className:"font-semibold flex gap-2 items-center",children:[N.name,(0,b.jsxs)("span",{className:"bg-gray-200 text-gray-400 ml-1 px-1 text-xs",children:[" ",N.type.toLocaleUpperCase()]})," ","+",N.mobile]}),(0,b.jsxs)("p",{children:[N.area,", ",N.city,","," ",N.state," – ",N.pin]})]}),x&&(0,b.jsxs)("div",{className:"mt-3 space-y-3 text-xs lg:text-base",children:[L.map(a=>(0,b.jsxs)("label",{className:"flex gap-3 border border-gray-200 rounded-md p-3 cursor-pointer",children:[(0,b.jsx)("input",{type:"radio",name:"address",checked:z===a._id,onChange:()=>{A(a._id),sessionStorage.setItem("SELECTED_ADDRESS_ID",a._id)},className:"mt-1"}),(0,b.jsxs)("div",{className:"text-xs lg:text-base",children:[(0,b.jsxs)("p",{className:"font-semibold",children:[a.name," (",a.type,")"]}),(0,b.jsx)("p",{children:a.addressLine}),(0,b.jsxs)("p",{children:[a.city,", ",a.state," – ",a.pincode]}),(0,b.jsxs)("p",{className:"mt-1",children:["Mobile: ",a.mobile]})]})]},a._id)),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{onClick:()=>{z&&sessionStorage.setItem("SELECTED_ADDRESS_ID",z),y(!1)},className:"text-xs lg:text-base p-1 lg:p-2 bg-define-brown text-white rounded",children:"Deliver Here"})})]})]}),O.slice().reverse().map((a,d)=>{let e=R(a),f=a.productId.stock||0,g="out"===e,h=a.quantity<f,i=a.productId,j=i.price*a.quantity,k=i.mrp*a.quantity;return(0,b.jsxs)("div",{className:"flex flex-col md:flex-row bg-white border border-gray-200 rounded-md p-4 gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col items-center w-full md:w-40",children:[(0,b.jsx)("div",{className:"relative w-full h-72 md:h-40 bg-gray-100 rounded overflow-hidden",children:(0,b.jsx)(c.default,{src:a.productId.coverImage.url,alt:a.productId.name,fill:!0,className:"object-cover"})}),(0,b.jsxs)("div",{className:"md:flex hidden items-center mt-2 ",children:[(0,b.jsx)("button",{onClick:()=>Z(a.productId._id,a.variantId?._id,a.quantity-1),className:"px-4 py-2 border text-define-black border-gray-200 rounded-full hover:bg-gray-100",children:"−"}),(0,b.jsx)("span",{className:"px-4 py-1 border text-define-black border-gray-200 mx-2",children:a.quantity}),(0,b.jsx)("button",{onClick:()=>Z(a.productId._id,a.variantId?._id,a.quantity+1),className:"px-4 py-2 border text-define-black border-gray-200 rounded-full hover:bg-gray-100",children:"+"})]})]}),(0,b.jsxs)("div",{className:"flex-1 flex flex-col justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-[18px] text-define-brown",children:a.productId.name}),(0,b.jsx)("p",{className:"text-sm text-gray-500 pt-1",children:a.productId.variables?.map(a=>`${a.name}: ${a.values.join(", ")}`).join(" | ")}),(0,b.jsx)("p",{className:"mt-2 text-sm text-define-black line-clamp-1",dangerouslySetInnerHTML:{__html:a.productId.shortDescription}}),(0,b.jsxs)("p",{className:"mt-2 font-bold text-define-red text-lg",children:[(0,b.jsx)(l.FaRupeeSign,{className:"inline"}),j.toFixed(0),(0,b.jsxs)("span",{className:"line-through text-gray-400 text-sm ml-3",children:[(0,b.jsx)(l.FaRupeeSign,{className:"inline"}),k.toFixed(0)]}),(0,b.jsxs)("span",{className:"text-define-red text-[13px] ml-2 font-normal",children:[a.productId.discount,"% OFF"]})]}),g?(0,b.jsx)("div",{className:"mt-2 px-3 w-fit py-1 bg-red-100 text-red-700 text-xs rounded-full font-medium",children:"Out of Stock"}):"low"===e?(0,b.jsxs)("div",{className:"mt-2 px-3 py-1 w-fit bg-orange-100 text-orange-700 text-xs rounded-full font-medium",children:["Only ",f," left"]}):null]}),(0,b.jsxs)("div",{className:"md:flex hidden gap-4 justify-evenly md:justify-start pt-4 lg:pt-0 md:pb-2 lg:pb-0",children:[(0,b.jsx)("button",{className:"font-bold hover:text-define-brown text-define-black text-sm lg:text-lg lg:px-6 lg:py-2 ",onClick:()=>$(a),children:"MOVE TO WISHLIST"}),(0,b.jsx)("button",{onClick:()=>_(a),className:"font-semibold text-define-black hover:text-define-red text-sm lg:text-lg lg:px-6 lg:py-2",children:"REMOVE"})]})]}),(0,b.jsxs)("div",{className:"flex md:hidden items-center gap-4 mt-3 w-full",children:[(0,b.jsxs)("div",{className:"flex lg:hidden items-center border border-gray-200 rounded-md overflow-hidden h-10",children:[(0,b.jsx)("button",{onClick:()=>Z(a.productId._id,a.variantId?._id,a.quantity-1),className:"px-2 h-full bg-gray-50 text-define-black hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",disabled:a.quantity<=1||g,children:"−"}),(0,b.jsx)("span",{className:"px-3 h-full flex items-center justify-center text-sm font-semibold text-define-black border-x border-gray-200 min-w-10",children:a.quantity}),(0,b.jsx)("button",{onClick:()=>Z(a.productId._id,a.variantId?._id,a.quantity+1),className:`px-2 h-full transition-colors ${h&&!g?"bg-gray-50 text-define-black hover:bg-gray-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,disabled:!h||g,children:"+"})]}),(0,b.jsx)("button",{className:`h-[40px]    text-xs font-bold tracking-wide uppercase transition-all duration-200 flex items-center justify-center
      ${g?"border-gray-200 text-gray-400 cursor-not-allowed bg-gray-50":"border-gray-300 text-define-black hover:border-define-brown hover:text-define-brown"}`,onClick:()=>$(a),disabled:g,children:"MOVE TO WISHLIST"}),(0,b.jsx)("button",{onClick:()=>_(a),className:`h-[40px]   text-xs  font-bold tracking-wide uppercase transition-all duration-200 flex items-center justify-center
      ${g?"border-gray-200 text-red-300":"border-gray-300 text-define-black hover:border-red-500 hover:text-red-600 hover:bg-red-50"}`,children:"Remove"})]})]},a.productId._id)})]}),(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-md p-4 h-fit sticky top-24 self-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-define-black border-b border-gray-200 pb-2",children:"Have a Coupon Code?"}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-4",children:[(0,b.jsx)("input",{value:H,onChange:a=>I(a.target.value),placeholder:"Enter coupon code",className:"flex-1 border text-define-black placeholder:text-define-black border-gray-200 rounded-full px-4 py-2 text-sm outline-none"}),(0,b.jsx)("button",{onClick:()=>{n?(q(null),I(""),s(0),u("")):(()=>{let b=a.find(a=>a.code.toLowerCase()===H.toLowerCase());if(!b){u("Invalid or ineligible coupon"),s(0),q(null);return}ab(b)})()},className:`rounded-full px-6 py-2 text-sm font-medium whitespace-nowrap transition
    ${n?"border border-red-500 text-red-500 hover:bg-red-50":"border border-define-brown text-define-brown hover:bg-red-50"}`,children:n?"Remove":"Apply"})]})]}),a.length>0&&(0,b.jsx)("div",{className:"relative mt-3",children:(0,b.jsx)("div",{className:"flex overflow-x-auto scroll-smooth snap-x snap-mandatory custom-scroll py-2 gap-2",children:a.filter(a=>!1!==a.status&&a.usageLimit>0).map(a=>(0,b.jsx)("div",{className:"min-w-full snap-center px-1",children:(0,b.jsxs)("button",{onClick:()=>{I(a.code),ab(a)},className:"w-full border  flex flex-col gap-2 justify-between border-define-red text-define-red rounded-xl px-4 py-3 text-sm font-medium hover:bg-red-50 transition text-center",children:[(0,b.jsx)("span",{children:a.name}),(0,b.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"Tap to apply"})]})},a.code))})}),(0,b.jsxs)("div",{className:"text-sm space-y-3 mt-5 text-define-black",children:[(0,b.jsx)("h2",{className:"font-semibold text-lg",children:"Order Summary"}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsxs)("span",{children:["Price (",W," items)"]}),(0,b.jsxs)("span",{children:[(0,b.jsx)(l.FaRupeeSign,{className:"inline"}),T.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Discount"}),(0,b.jsxs)("span",{className:"text-define-red",children:["-",(0,b.jsx)(l.FaRupeeSign,{className:"inline"}),U.toLocaleString()]})]}),r>0&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Coupon Discount"}),(0,b.jsxs)("span",{className:"text-define-red",children:["-",(0,b.jsx)(l.FaRupeeSign,{className:"inline"}),r.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between font-semibold text-lg border-t border-gray-200 text-define-black pt-3",children:[(0,b.jsx)("span",{children:"Total Amount"}),(0,b.jsxs)("span",{children:[(0,b.jsx)(l.FaRupeeSign,{className:"inline"}),ac.toLocaleString()]})]})]}),(0,b.jsx)("button",{onClick:Y,disabled:X||V<=0||!N,className:`mt-6 w-full rounded-full py-3 text-white font-semibold hover:scale-[1.03] transition-all duration-200 flex items-center justify-center ${X||V<=0||!N?"bg-gray-400 cursor-not-allowed from-gray-400 to-gray-500":"btn-grad"}`,children:X?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"w-5 h-5 mr-2",children:(0,b.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),"Remove out-of-stock items to pay"]}):V<=0?"Empty Cart":N?(0,b.jsxs)(b.Fragment,{children:["Pay"," ",(0,b.jsx)(l.FaRupeeSign,{className:"inline"}),Math.max(V-r,0).toLocaleString()," ","Now"]}):"Select Address First"})]}),C&&(0,b.jsx)(o,{onClose:()=>D(!1),onSuccess:async a=>{await F(),sessionStorage.setItem("SELECTED_ADDRESS_ID",a),A(a),y(!1),D(!1)}})]}):(0,b.jsx)("div",{className:"bg-white p-6 rounded-md text-center text-gray-500",children:"Your cart is empty"})}a.s(["default",()=>q],48119)}];

//# sourceMappingURL=src_components_extras_CheckoutClient_tsx_4d31845d._.js.map